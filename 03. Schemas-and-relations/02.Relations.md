# Relations

- How to store related data?
- There are some entities that are related in our application.
- Should we use embedded documents or refrence to some other documnet in some other collection.


## Embedding

- Lets say we have a `users` collection and their `fav books` as embedded array.
- In this case there will be lots of duplication at user level as multiple `users` can have same `favourite books`.
- Also, later if we update a book, thet needs to be updated at multiple places at user level.


## Storing references

- Insted of storing all the data at user level, we just store the id of their favourite books.
- But when I query users, I also want full details of their favourite books, not just the book ID.

## Modelling One to one relationship

- Generally for 1 to 1 relationships, we use embedding as there is no duplication.
- But lets say for analytics purpose, we have to split our data across two collections.
- In this case depending on what makes more sense, we can store reference of some document into some document from other collection.


## Modelling One to many relationship

- We can use embedding as well as references. References are preferred.
- When using reference, we can either store array or we can store single ID based on the query and what kind of data to display where.
- If we have a `city` collection and `citizens`. It depends whether we are showing list of citizens acoording to a preselcted city or we are showing list of citizens and their city along with it.
- Generally we gro from many to one and store single entity in multiple rows. That's more convinient than storing million citizen ids in a city document.


## Many to many relationships

- Many to many are always mapped using references.
- Example is `customer` and `products`.
- In SQL world we will have to use a third table to map this relationship.
- But since mongo supports arrays, two are just enough.


## Joining collections with $lookup

- `$lookup` accepts 4 parameters.
  - `from` name of other collection.
  - `localField` the property name in the local collection.
  - `foreignField` the property name of the other collection.
  - `as` the property name which will hold the result of merging.
 

```ts
collection1.aggregate([
  {
    $lookup: {
      from: "otherCollectionName",
      localField: "",
      foreignField: "",
      as: "",
    },
  },
]);
``` 
